---

title: Testing translate_tsv()


keywords: fastai
sidebar: home_sidebar



nb_path: "nbdev_nbs/spec_lib/test_translate_tsv.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbdev_nbs/spec_lib/test_translate_tsv.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">alphabase.peptide.fragment</span> <span class="kn">import</span> <span class="n">create_fragment_mz_dataframe</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;sandbox&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;sandbox&#39;</span><span class="p">)</span>

<span class="n">repeat</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">charged_frag_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b_z1&#39;</span><span class="p">,</span><span class="s1">&#39;y_z1&#39;</span><span class="p">,</span><span class="s1">&#39;y_modloss_z1&#39;</span><span class="p">]</span>
<span class="n">precursor_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sequence&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;ASGHCEWMKYR&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;ASGHCEWMAAR&#39;</span><span class="p">],</span>
    <span class="s1">&#39;mods&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Acetyl@Protein N-term;Carbamidomethyl@C;Oxidation@M&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;mod_sites&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0;4;8&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">repeat</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
    <span class="s1">&#39;nAA&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s1">&#39;NCE&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;instrument&#39;</span><span class="p">:</span> <span class="s1">&#39;QE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rt_pred&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;charge&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;protein_name&#39;</span><span class="p">:</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mobility_pred&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">})</span>
<span class="n">precursor_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,[</span><span class="s1">&#39;mods&#39;</span><span class="p">,</span><span class="s1">&#39;mod_sites&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Phospho@S&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]</span>
<span class="n">frag_mass_df</span> <span class="o">=</span> <span class="n">create_fragment_mz_dataframe</span><span class="p">(</span><span class="n">precursor_df</span><span class="p">,</span> <span class="n">charged_frag_types</span><span class="p">)</span>
<span class="n">frag_mass_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>b_z1</th>
      <th>y_z1</th>
      <th>y_modloss_z1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>72.044390</td>
      <td>1376.527555</td>
      <td>1278.550659</td>
    </tr>
    <tr>
      <th>1</th>
      <td>239.042750</td>
      <td>1209.529195</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>296.064213</td>
      <td>1152.507732</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>433.123125</td>
      <td>1015.448820</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>536.132310</td>
      <td>912.439635</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>105</th>
      <td>585.208572</td>
      <td>634.312978</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>106</th>
      <td>771.287885</td>
      <td>448.233665</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>107</th>
      <td>902.328370</td>
      <td>317.193180</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>108</th>
      <td>973.365484</td>
      <td>246.156066</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>109</th>
      <td>1044.402598</td>
      <td>175.118952</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
<p>110 rows × 3 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">alphabase.spectral_library.library_base</span> <span class="kn">import</span> <span class="n">SpecLibBase</span>
<span class="n">spec_lib</span> <span class="o">=</span> <span class="n">SpecLibBase</span><span class="p">(</span><span class="n">charged_frag_types</span><span class="p">)</span>
<span class="n">spec_lib</span><span class="o">.</span><span class="n">_precursor_df</span> <span class="o">=</span> <span class="n">precursor_df</span>
<span class="n">spec_lib</span><span class="o">.</span><span class="n">_fragment_intensity_df</span> <span class="o">=</span> <span class="n">frag_mass_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">spec_lib</span><span class="o">.</span><span class="n">_fragment_mz_df</span> <span class="o">=</span> <span class="n">frag_mass_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">peptdeep.spec_lib.translate</span> <span class="kn">import</span> <span class="n">speclib_to_single_df</span><span class="p">,</span> <span class="n">translate_to_tsv</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">speclib_sdf</span> <span class="o">=</span> <span class="n">speclib_to_single_df</span><span class="p">(</span><span class="n">spec_lib</span><span class="p">)</span>
<span class="n">translate_to_tsv</span><span class="p">(</span><span class="n">spec_lib</span><span class="p">,</span> <span class="s1">&#39;sandbox/lib.tsv&#39;</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">multiprocessing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ddf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;sandbox/lib.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">ddf</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">speclib_sdf</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ddf</span><span class="o">.</span><span class="n">StrippedPeptide</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">speclib_sdf</span><span class="o">.</span><span class="n">StrippedPeptide</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">ddf</span><span class="o">.</span><span class="n">StrippedPeptide</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">speclib_sdf</span><span class="o">.</span><span class="n">StrippedPeptide</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">ddf</span><span class="o">.</span><span class="n">PrecursorCharge</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">int</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>11it [00:01,  5.70it/s]
100%|██████████| 6/6 [00:00&lt;00:00, 51.14it/s]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Translation finished, it will take several minutes to export the rest precursors to the tsv file...
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

